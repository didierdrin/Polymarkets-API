<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polymarket Data</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      margin-bottom: 24px;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 16px;
    }
    .error {
      background: #fee;
      border: 1px solid #fcc;
      padding: 16px;
      border-radius: 8px;
      color: #c33;
      margin: 20px 0;
    }
    .warning {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 16px;
      border-radius: 8px;
      color: #856404;
      margin: 20px 0;
    }
    .market {
      background: white;
      padding: 20px;
      margin-bottom: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .market:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .market-title {
      font-size: 18px;
      font-weight: 600;
      color: #222;
      margin-bottom: 8px;
    }
    .market-info {
      color: #666;
      font-size: 14px;
      margin-top: 8px;
    }
    .market-volume {
      display: inline-block;
      background: #e3f2fd;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      margin-top: 8px;
    }
    .outcomes {
      margin-top: 12px;
      padding: 8px 0;
      border-top: 1px solid #eee;
    }
    .outcome {
      display: inline-block;
      padding: 4px 8px;
      margin: 2px 4px 2px 0;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    .outcome-yes {
      background: #d4edda;
      color: #155724;
    }
    .outcome-no {
      background: #f8d7da;
      color: #721c24;
    }
    .toggle-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      margin-top: 8px;
    }
    .toggle-btn:hover {
      background: #0056b3;
    }
    .sub-markets {
      display: none;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #eee;
    }
    .sub-markets.show {
      display: block;
    }
    .sub-market {
      background: #f8f9fa;
      padding: 12px;
      margin: 8px 0;
      border-radius: 4px;
      border-left: 3px solid #007bff;
    }
    .sub-market-title {
      font-weight: 600;
      font-size: 14px;
      color: #333;
      margin-bottom: 6px;
    }
    .sub-market-desc {
      font-size: 12px;
      color: #666;
      margin: 6px 0;
    }
    .refresh-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-bottom: 20px;
    }
    .refresh-btn:hover {
      background: #0056b3;
    }
    .refresh-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 20px 0;
    }
    .pagination button {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .pagination button:hover {
      background: #0056b3;
    }
    .pagination button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .page-info {
      color: #666;
      font-size: 14px;
    }
    .solution-box {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 16px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .solution-box h3 {
      margin-top: 0;
      color: #1976D2;
    }
    .solution-box code {
      background: #f5f5f5;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>Polymarket Live Markets</h1>
  <button id="refreshBtn" class="refresh-btn">Refresh Data</button>
  
  <div class="pagination">
    <button id="prevBtn" disabled>Previous</button>
    <span id="pageInfo" class="page-info">Page 1</span>
    <button id="nextBtn">Next</button>
  </div>
  
  <div id="markets">
    <div class="loading">Loading markets...</div>
  </div>
  
  <div class="pagination">
    <button id="prevBtn2" disabled>Previous</button>
    <span id="pageInfo2" class="page-info">Page 1</span>
    <button id="nextBtn2">Next</button>
  </div>

  <script>
    const marketsDiv = document.getElementById('markets');
    const refreshBtn = document.getElementById('refreshBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn2 = document.getElementById('prevBtn2');
    const nextBtn2 = document.getElementById('nextBtn2');
    const pageInfo = document.getElementById('pageInfo');
    const pageInfo2 = document.getElementById('pageInfo2');
    
    let currentOffset = 0;
    const limit = 10;

    function updatePaginationControls(hasData) {
      const currentPage = Math.floor(currentOffset / limit) + 1;
      const canGoPrev = currentOffset > 0;
      const canGoNext = hasData && hasData.length === limit;
      
      prevBtn.disabled = prevBtn2.disabled = !canGoPrev;
      nextBtn.disabled = nextBtn2.disabled = !canGoNext;
      pageInfo.textContent = pageInfo2.textContent = `Page ${currentPage}`;
    }

    async function fetchMarkets() {
      refreshBtn.disabled = true;
      marketsDiv.innerHTML = '<div class="loading">Loading markets...</div>';
      
      try {
        // Try multiple CORS proxies in order
        const proxies = [
          'https://corsproxy.io/?',
          'https://api.codetabs.com/v1/proxy?quest=',
          ''  // Direct attempt as fallback
        ];
        
        const apiUrl = `https://gamma-api.polymarket.com/events?closed=false&limit=${limit}&offset=${currentOffset}`;
        let data = null;
        let lastError = null;
        
        for (const proxy of proxies) {
          try {
            const url = proxy + (proxy ? encodeURIComponent(apiUrl) : apiUrl);
            const response = await fetch(url);
            
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }
            
            data = await response.json();
            break; // Success, exit loop
          } catch (err) {
            lastError = err;
            continue; // Try next proxy
          }
        }
        
        if (!data) {
          throw lastError || new Error('All proxies failed');
        }
        
        if (!data || data.length === 0) {
          marketsDiv.innerHTML = '<div class="warning">No markets found</div>';
          return;
        }
        
        console.log('Sample event:', data[0]); // Debug log
        
        marketsDiv.innerHTML = data.map((event, eventIndex) => {
          const subMarketsHtml = event.markets?.map((market, marketIndex) => {
            if (!market.outcomePrices || !market.outcomes) return '';
            const prices = JSON.parse(market.outcomePrices);
            const outcomes = JSON.parse(market.outcomes);
            const outcomesHtml = outcomes.map((outcome, i) => {
              const colorClass = outcome.toLowerCase() === 'yes' ? 'outcome-yes' : 'outcome-no';
              return `<span class="outcome ${colorClass}">${outcome}: ${(prices[i] * 100).toFixed(1)}%</span>`;
            }).join('');
            
            return `
              <div class="sub-market">
                <div class="sub-market-title">${market.groupItemTitle || market.question || 'Market'}</div>
                ${market.description ? `<div class="sub-market-desc">${market.description.substring(0, 150)}${market.description.length > 150 ? '...' : ''}</div>` : ''}
                <div class="outcomes">${outcomesHtml}</div>
              </div>
            `;
          }).join('') || '';
          
          return `
            <div class="market">
              <div class="market-title">${event.title || 'Untitled Market'}</div>
              <div class="market-info">
                ${event.description ? `<div style="margin: 8px 0;">${event.description.substring(0, 200)}${event.description.length > 200 ? '...' : ''}</div>` : ''}
                ${event.volume ? `<span class="market-volume">Volume: $${Number(event.volume).toLocaleString()}</span>` : ''}
                ${event.endDate ? `<div style="margin-top: 8px; font-size: 13px;">Closes: ${new Date(event.endDate).toLocaleDateString()}</div>` : ''}
                ${event.markets?.length > 0 ? `<button class="toggle-btn" onclick="document.getElementById('sub-${eventIndex}').classList.toggle('show')">Show ${event.markets.length} Markets</button>` : ''}
              </div>
              ${subMarketsHtml ? `<div id="sub-${eventIndex}" class="sub-markets">${subMarketsHtml}</div>` : ''}
            </div>
          `;
        }).join('');
        
        updatePaginationControls(data);
        
      } catch (error) {
        console.error('Error fetching markets:', error);
        marketsDiv.innerHTML = `
          <div class="error">
            <strong>‚ö†Ô∏è Unable to Load Polymarket Data</strong><br><br>
            Error: ${error.message}
          </div>
          
          <div class="solution-box">
            <h3>üîß Solution: Backend API Required</h3>
            <p>The Polymarket API blocks direct browser requests due to CORS security policies. To make this work, you need a backend server.</p>
            
            <p><strong>Option 1: Node.js Backend</strong></p>
            <p>Create a simple Express server:</p>
            <pre style="background: #f5f5f5; padding: 12px; border-radius: 4px; overflow-x: auto;">
// server.js
const express = require('express');
const fetch = require('node-fetch');
const cors = require('cors');

const app = express();
app.use(cors());

app.get('/api/markets', async (req, res) => {
  try {
    const response = await fetch(
      'https://gamma-api.polymarket.com/events?closed=false&limit=10'
    );
    const data = await response.json();
    res.json(data);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.listen(3000, () => console.log('Server running on port 3000'));
            </pre>
            
            <p><strong>Option 2: Vercel Serverless Function</strong></p>
            <p>Since you're using Vercel, create <code>/api/markets.js</code>:</p>
            <pre style="background: #f5f5f5; padding: 12px; border-radius: 4px; overflow-x: auto;">
// api/markets.js
export default async function handler(req, res) {
  try {
    const response = await fetch(
      'https://gamma-api.polymarket.com/events?closed=false&limit=10'
    );
    const data = await response.json();
    res.status(200).json(data);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
}
            </pre>
            <p>Then update your fetch to: <code>fetch('/api/markets')</code></p>
            
            <p><strong>Option 3: Use Polymarket's Official Client</strong></p>
            <p>Check if Polymarket offers a JavaScript SDK or official API that supports browser usage.</p>
          </div>
        `;
      } finally {
        refreshBtn.disabled = false;
      }
    }

    refreshBtn.addEventListener('click', () => {
      currentOffset = 0;
      fetchMarkets();
    });
    
    prevBtn.addEventListener('click', () => {
      if (currentOffset > 0) {
        currentOffset -= limit;
        fetchMarkets();
      }
    });
    
    nextBtn.addEventListener('click', () => {
      currentOffset += limit;
      fetchMarkets();
    });
    
    prevBtn2.addEventListener('click', () => {
      if (currentOffset > 0) {
        currentOffset -= limit;
        fetchMarkets();
      }
    });
    
    nextBtn2.addEventListener('click', () => {
      currentOffset += limit;
      fetchMarkets();
    });
    
    // Initial load
    fetchMarkets();
  </script>
</body>
</html>



